name: Auto Post to WordPress

on:
  workflow_dispatch:
    inputs:
      post_limit:
        description: "How many posts to process this run (e.g. 20, 2000)"
        required: true
        default: "20"
      mode:
        description: "skip (no update) or update (update existing posts)"
        required: true
        default: "skip"
      wp_status:
        description: "draft or publish"
        required: true
        default: "draft"
  schedule:
    - cron: "0 * * * *" # 毎時0分（必要なら変更）

jobs:
  run:
    runs-on: ubuntu-latest
    env:
      WP_BASE_URL: ${{ secrets.WP_BASE_URL }}
      WP_USER: ${{ secrets.WP_USER }}
      WP_APP_PASS: ${{ secrets.WP_APP_PASS }}
      GOOGLE_SHEET_ID: ${{ secrets.GOOGLE_SHEET_ID }}

      SHEET_NAME: "シート4"
      MAX_TAGS: "10"
      RANDOM_PICK: "1"

      POST_LIMIT: ${{ github.event.inputs.post_limit || '100' }}
      MODE: ${{ github.event.inputs.mode || 'update' }}
      WP_STATUS: ${{ github.event.inputs.wp_status || 'draft' }}

      # 既存投稿のアイキャッチを毎回更新したいなら 1（通常は0のまま）
      FORCE_FEATURED: "0"

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install deps
        run: npm install

      - name: Run posting script
        run: node scripts/post-to-wp.js
